        -:    0:Source:D:/Project_mp/testfinal/test/compare.c
        -:    0:Programs:14
        -:    1:#include "testhead.h"
        -:    2:// function for testing the output with the expected output
       21:    3:uint16_t Test_ing(const uint8_t ModbusTxBuf[], const uint8_t Test_tx[])
        -:    4:{   
       21:    5:    Test_Res = 1;
       21:    6:    test_c = 0;
        -:    7:
        -:    8:    // Data enter check for FC 0x06
       21:    9:    if (ModbusRxBuf[7] == 0x06)
        -:   10:    {
        3:   11:        add = (ModbusRxBuf[8] << 8) | ModbusRxBuf[9];
        3:   12:        test_c = (Dataregister[add] != ((ModbusRxBuf[10] << 8) | ModbusRxBuf[11])) ? 1 : 0;
        -:   13:    }
        -:   14:
        -:   15:    // Data enter check for FC  0x10
       21:   16:    if (ModbusRxBuf[7] == 0x10)
        -:   17:    {
        3:   18:        add = (ModbusRxBuf[8] << 8) | ModbusRxBuf[9];
        3:   19:        numRegisters = (ModbusRxBuf[10] << 8) | ModbusRxBuf[11];
        -:   20:
        9:   21:        for (increment = 0; increment < numRegisters; increment++)
        -:   22:        {
        6:   23:            receivedData = (ModbusRxBuf[13 + increment * 2] << 8) | ModbusRxBuf[14 + increment * 2];
        6:   24:            test_c = (Dataregister[add + increment] != receivedData) ? 1 : 0;
        -:   25:        }
        -:   26:    }
        -:   27: 
        -:   28:    // Data enter check for FC  0x05
       21:   29:    if (ModbusRxBuf[7] == 0x05)
        -:   30:    {
        3:   31:        int reg = (ModbusRxBuf[9] - 1) / 16;
        3:   32:        int bit = (ModbusRxBuf[9] - 1) % 16;
        -:   33:
        3:   34:        if (ModbusRxBuf[10] == 0xff)
        -:   35:        {
        2:   36:            SET(regis[reg], bit);
        -:   37:        }
        -:   38:        else
        -:   39:        {
        1:   40:            CLR(regis[reg], bit);
        -:   41:        }
        -:   42:       // printf("\n%04x - %04x", COIL[reg],regis[reg]);
        3:   43:        test_c = (Dataregister[reg] != regis[reg]) ? 1 : 0;
        -:   44:    }
        -:   45:
       21:   46:    if (ModbusRxBuf[7] == 0x0f)
        -:   47:    {
        -:   48:        unsigned int bit_count, reg, regbit, a, b, d;
        -:   49:        uint16_t c[25];
        -:   50:
       15:   51:        for (int i = 0; i < ModbusRxBuf[12]; i++)
        -:   52:        {
       12:   53:            c[i] = (ModbusRxBuf[(i * 2) + 14] << 8) | ModbusRxBuf[(i * 2) + 13];
        -:   54:        }
        -:   55:
       63:   56:        for (bit_count = ModbusRxBuf[11] - 1; bit_count >= 0; bit_count--)
        -:   57:        {
      123:   58:            regbit = ((ModbusRxBuf[9] + bit_count) - 1) % 16;
       63:   59:            reg = ((ModbusRxBuf[9] + bit_count) - 1) / 16;
        -:   60:
       63:   61:            a = bit_count % 16;
       63:   62:            b = bit_count / 16;
        -:   63:
       63:   64:            d = GET_BIT(c[b], a);
        -:   65:
       63:   66:            if (d == 0x1)
        -:   67:            {
       34:   68:                SET(COIL1[reg], regbit);
        -:   69:            }
        -:   70:            else
        -:   71:            {
       29:   72:                CLR(COIL1[reg], regbit);
        -:   73:            }
       63:   74:            if (bit_count == 0)
        -:   75:            {
        3:   76:                break;
        -:   77:            }
        -:   78:        }
        3:   79:        reg = ((ModbusRxBuf[9] + bit_count) - 1) / 16;
        3:   80:        for (int i = reg; i <= reg +(ModbusRxBuf[12]/2); i++)
        -:   81:        {
        3:   82:            printf("\n%04x--%04x  ", COIL[i], COIL1[i]);
        3:   83:            if ((Dataregister[i] != COIL1[i]))
        -:   84:            {
        3:   85:                test_c = 1;
        3:   86:                break;
        -:   87:            }
        -:   88:        }
        -:   89:    }
        -:   90:
       21:   91:    numRegisters = (ModbusTxBuf[7] < 0x80) ? (0x09 + ModbusTxBuf[8]) : 0x09;
        -:   92:    // send packet check for all function code
      223:   93:    for (increment = 0; increment < numRegisters; increment++)
        -:   94:    {
        -:   95:        // Test_Res = (ModbusTxBuf[increment] != Test_tx[increment]) ? 0 : 1;
      202:   96:        if ((ModbusTxBuf[increment] != Test_tx[increment]))
        -:   97:        {
    #####:   98:            Test_Res = 0;
    #####:   99:            break; // Exit the loop or block
        -:  100:        }
        -:  101:    }
        -:  102:
       21:  103:    return Test_Res;
        -:  104:}
