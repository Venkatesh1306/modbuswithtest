        -:    0:Source:D:/Project_mp/testfinal/Modbus1/ReadInputRegisters.c
        -:    0:Programs:14
        -:    1:#include "testingdata.h"
        -:    2:
        -:    3:unsigned int a, b;
        -:    4:unsigned int bytes;
        -:    5:
        2:    6:WORD ReadInputReg(BYTE *ModbusTcpTxBuf, WORD *InputRegister, parse1 *parse)
        -:    7:{
        -:    8:
        2:    9:  ModbusTcpTxBuf[0] = parse->TransactionID.v[1];
        2:   10:  ModbusTcpTxBuf[1] = parse->TransactionID.v[0];
        -:   11:
        2:   12:  ModbusTcpTxBuf[2] = parse->ProtocolID.v[1];
        2:   13:  ModbusTcpTxBuf[3] = parse->ProtocolID.v[0];
        -:   14:
        2:   15:  ModbusTcpTxBuf[4] = 0X0;
        -:   16:
        -:   17:  // Output[5] = 0X3 + Output[8];
        2:   18:  ModbusTcpTxBuf[6] = parse->UnitID;
        2:   19:  ModbusTcpTxBuf[7] = parse->FunctionCode;
        2:   20:  ModbusTcpTxBuf[8] = (char)(parse->NumberofRegister.Val * 2);
        2:   21:  ModbusTcpTxBuf[5] = ModbusTcpTxBuf[8] + 0X03;
        -:   22:
        6:   23:  for (a = 0; a < parse->NumberofRegister.Val; a++)
        -:   24:  {
        4:   25:    b = a * 2;
        -:   26:
        4:   27:    ModbusTcpTxBuf[9 + b] = InputRegister[parse->StartAddress.Val + a] / 0x100;
        4:   28:    ModbusTcpTxBuf[10 + b] = InputRegister[parse->StartAddress.Val + a] % 0x100;
        -:   29:  }
        -:   30:
        2:   31:  bytes = 0x9 + ModbusTcpTxBuf[8];
        2:   32:  return bytes;
        -:   33:  // return &ModbusTcpTxBuf;
        -:   34:}
